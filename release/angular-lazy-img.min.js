angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers",function(n,t,e,o){"use strict";function i(){for(var n=h.length-1;n>=0;n--){var t=h[n];t&&o.isElementInView(t.$elem[0],y.offset,f)&&(u(t),h.splice(n,1))}0===h.length&&a()}function r(n){z.forEach(function(t){t[n]("scroll",p),t[n]("touchmove",p)}),m[n]("resize",p),m[n]("resize",I)}function s(){d=!0,setTimeout(function(){i(),r("on")},1)}function a(){d=!1,r("off")}function c(n){var t=h.indexOf(n);-1!==t&&h.splice(t,1)}function u(n){var e=new Image;e.onerror=function(){y.errorClass&&n.$elem.addClass(y.errorClass),t.$emit("lazyImg:error",n),y.onError(n)},e.onload=function(){l(n.$elem,n.src),y.successClass&&n.$elem.addClass(y.successClass),t.$emit("lazyImg:success",n),y.onSuccess(n)},e.src=n.src}function l(n,t){"img"===n[0].nodeName.toLowerCase()?n[0].src=t:n.css("background-image",'url("'+t+'")')}function g(n){this.$elem=n}var f,m,h,d,y,p,I,z;return h=[],d=!1,y=e.getOptions(),m=angular.element(n),f=o.getWinDimensions(),I=o.throttle(function(){f=o.getWinDimensions()},60),z=[y.container||m],p=o.throttle(i,30),g.prototype.setSource=function(n){this.src=n,h.unshift(this),d||s()},g.prototype.removeImage=function(){c(this),0===h.length&&a()},g.prototype.checkImages=function(){i()},g.addContainer=function(n){a(),z.push(n),s()},g.removeContainer=function(n){a(),z.splice(z.indexOf(n),1),s()},g}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";function t(){return{height:n.innerHeight,width:n.innerWidth}}function e(n,t,e){var o=n.getBoundingClientRect(),i=e.height+t;return(o.left>=0||Math.abs(o.left)<n.offsetWidth)&&o.right<=e.width+t&&(o.top>=0&&o.top<=i||o.bottom<=i&&o.bottom>=0-t)}function o(n,t,e){var o,i;return function(){var r=e||this,s=+new Date,a=arguments;o&&o+t>s?(clearTimeout(i),i=setTimeout(function(){o=s,n.apply(r,a)},t)):(o=s,n.apply(r,a))}}return{isElementInView:e,getWinDimensions:t,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(n,t){"use strict";function e(e,o,i){var r=new t(o),s=i.$observe("lazyImg",function(n){n&&(s(),r.setSource(n))});e.$on("$destroy",function(){r.removeImage()}),n.$on("lazyImg.runCheck",function(){r.checkImages()}),n.$on("lazyImg:refresh",function(){r.checkImages()})}return{link:e,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(n){"use strict";function t(t,e){n.addContainer(e),t.$on("$destroy",function(){n.removeContainer(e)})}return{link:t,restrict:"A"}}]);